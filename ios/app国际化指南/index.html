<!DOCTYPE html>
<html lang="en-us">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">

<meta itemprop="name" content="APP国际化指南">
<meta itemprop="description" content="iOS国际化完全指南 看完这篇文章你可以解决国际化的绝大部分问题，并且本人重写了前人的脚本；可以实现代码，xib，storyboard的自动国">


<meta itemprop="datePublished" content="2018-12-19T15:39:51&#43;08:00" />
<meta itemprop="dateModified" content="2018-12-19T15:39:51&#43;08:00" />
<meta itemprop="wordCount" content="2200">



<meta itemprop="keywords" content="iOS,Python," />
<meta property="og:title" content="APP国际化指南" />
<meta property="og:description" content="iOS国际化完全指南 看完这篇文章你可以解决国际化的绝大部分问题，并且本人重写了前人的脚本；可以实现代码，xib，storyboard的自动国" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://z-figaro.github.io/ios/app%E5%9B%BD%E9%99%85%E5%8C%96%E6%8C%87%E5%8D%97/" />
<meta property="article:published_time" content="2018-12-19T15:39:51&#43;08:00"/>
<meta property="article:modified_time" content="2018-12-19T15:39:51&#43;08:00"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="APP国际化指南"/>
<meta name="twitter:description" content="iOS国际化完全指南 看完这篇文章你可以解决国际化的绝大部分问题，并且本人重写了前人的脚本；可以实现代码，xib，storyboard的自动国"/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title>APP国际化指南</title>
	<link rel="stylesheet" href="https://z-figaro.github.io/css/style.min.31706917653d2b9e8410abd431f30ec4359a88a94fc87a63654779d87329edec.css" integrity="sha256-MXBpF2U9K56EEKvUMfMOxDWaiKlPyHpjZUd52HMp7ew=">
	
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp faster">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://z-figaro.github.io/">Figaro ZP</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					<a href="https://z-figaro.github.io/dailynote/">Daily</a>
					<a href="https://z-figaro.github.io/golangnote/">Golang</a>
					<a href="https://z-figaro.github.io/python/">Python</a>
					<a href="https://z-figaro.github.io/ios/">iOS</a>
					<a href="https://z-figaro.github.io/about-me/">About</a>
				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<span class="hdr-social hide-in-mobile"><a href="https://www.facebook.com/zp.figaro.5" target="_blank" rel="noopener" title="Facebook"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-facebook"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg></a><a href="zpfigaro@gmail.com" target="_blank" rel="noopener" title="Email"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></a><a href="https://github.com/Z-figaro" target="_blank" rel="noopener" title="Github"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a></span><button id="menu-btn" class="hdr-btn" title="Menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://z-figaro.github.io/dailynote/">Daily</a></li>
			<li><a href="https://z-figaro.github.io/golangnote/">Golang</a></li>
			<li><a href="https://z-figaro.github.io/python/">Python</a></li>
			<li><a href="https://z-figaro.github.io/ios/">iOS</a></li>
			<li><a href="https://z-figaro.github.io/about-me/">About</a></li>
		</ul>
	</div>


	<main class="site-main section-inner thin animated fadeIn faster">
		<h1>APP国际化指南</h1>
		<div class="content">
			

<h1 id="ios国际化完全指南">iOS国际化完全指南<a href="#ios国际化完全指南" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>

<p>看完这篇文章你可以解决国际化的绝大部分问题，并且本人重写了前人的脚本；可以实现代码，xib，storyboard的自动国际化。自动新增，删除文字，项目中的所有内容，不需要再手动维护，新项目简单国际化，老项目轻松国际化。<a href="https://github.com/Z-figaro/ZPPLanguage" target="_blank">项目地址</a></p>

<p>我试图用XCodeEditor来实现一个mac应用，让我们的国际化完全不用在项目中操作，单个语言文件没问题，但是因为多个国际化语言的文件引用关系始终不能正确设置，所以没有成功，如果有mac开发的大佬或者对project.pbxproj 这个文件工程核心文件结构有了解的同学；可以联系我一起实现这个[项目]()</p>

<p>如果有不清楚的地方，欢迎联系我补充。</p>

<h2 id="国际化的基本姿势">国际化的基本姿势<a href="#国际化的基本姿势" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>

<p>一个项目要国际化，首先要在project 的 build settings 中添加需要的文件：</p>

<p><img src="https://raw.githubusercontent.com/Z-figaro/picBed/master/image/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-04-28%20%E4%B8%8A%E5%8D%881.44.28.png?token=ADLKPSTG5DGAT2GFFAHPNVS4YSKVA" alt="" /></p>

<p>这里是选择整个项目要支持的语言，点+号选择你需要的就好了。</p>

<p><img src="https://raw.githubusercontent.com/Z-figaro/picBed/master/image/xib%E5%9B%BD%E9%99%85%E5%8C%962019-04-28%20%E4%B8%8A%E5%8D%881.56.05.png?token=ADLKPSS6V3CNPTVNTCWY5FK4YSMCA" alt="" /></p>

<h3 id="xib和stroyboard国际化">Xib和stroyboard国际化<a href="#xib和stroyboard国际化" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>

<p>如果是新项目，我强烈建议你劲量多的使用 xib 和 stroyboard 来构建项目，因为如果你遇到了要支持阿拉伯地区的语言，他们的习惯是从右到左的，也就是系统的RTL（rignt to left）。整个界面都需要镜像翻转，那时候系统提供的方法只支持xib 和stroyboard 。你如果用的纯代码写死，那么会麻烦很多。</p>

<p>xib和SB要国际化，其实很简单；只需要在相应的文件中选择
点击Localization，选择相应的语言，系统就会自动修改项目的实际文件结构：</p>

<p><img src="https://raw.githubusercontent.com/Z-figaro/picBed/master/image/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-04-28%20%E4%B8%8A%E5%8D%881.58.46.png?token=ADLKPSVRD5MJPTVSH6PNUFK4YSMK6" alt="" /></p>

<p>会出现以下的项目样子：
<img src="https://raw.githubusercontent.com/Z-figaro/picBed/master/image/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-04-28%20%E4%B8%8A%E5%8D%882.02.06.png?token=ADLKPSRBRPXIZWBFSNAA2QS4YSM2G" alt="" /></p>

<p>这里要注意下，系统自动生成的文件中会出现已经在xib或者SB 中使用的字符；但是只会生成在你点击Localization那一个时刻已经有了的字符，如果你持续开发。又添加删除了控件，那么不会自动生成。只有取消该部分国际化，然后再把这种语言打钩，选择上之后才会生成新的文件，并且会覆盖掉你之前已经写好的国际化文件。本脚本已经解决这个问题，不再需要手动维护。解决原理是：</p>

<pre><code>ibtool --generate-stringsfile MyNib.strings MyNib.nib
</code></pre>

<p>ibtool这个小工具，系统自带。可以自动把xib或者sb 生成一个.stings文件。</p>

<h3 id="代码国际化">代码国际化<a href="#代码国际化" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>

<p>代码部分的国际化，只有一个办法就是使用系统的国际化宏：</p>

<pre><code>NSLocalizedString(&quot;这里是需要国际化的字符&quot;,comment: &quot;这里是注释&quot;)

#define NSLocalizedString(key, comment) \
	    [NSBundle.mainBundle localizedStringForKey:(key) value:@&quot;&quot; table:nil]

...
/* Method for retrieving localized strings. */
- (NSString *)localizedStringForKey:(NSString *)key value:(nullable NSString *)value table:(nullable NSString *)tableName NS_FORMAT_ARGUMENT(1);


#define NSLocalizedStringFromTable(key, tbl, comment) \
	    [NSBundle.mainBundle localizedStringForKey:(key) value:@&quot;&quot; table:(tbl)]
#define NSLocalizedStringFromTableInBundle(key, tbl, bundle, comment) \
	    [bundle localizedStringForKey:(key) value:@&quot;&quot; table:(tbl)]

</code></pre>

<p>NSLocalizedStringFromTable(key, tbl, comment) 这种方式比较少用，因为这个tbl就是tbl.strings的名字，在代码部分使用了宏之后。你还需要生成资源文件.strings:
<img src="https://raw.githubusercontent.com/Z-figaro/picBed/master/image/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-04-28%20%E4%B8%8A%E5%8D%882.26.26.png?token=ADLKPSVIMCXP7B5EV5O44JS4YSPVU" alt="" /></p>

<p>你生成这个文件的时候，输入的文件名如果是 <em>Localizable</em> 那么你就使用第一个宏，如果你输入了别的名字，那么你就应该使用 NSLocalizedStringFromTable(key, tbl, comment)。其中的tbl就是你输入的文件名称。</p>

<p>我的python脚本只支持第一种方式的宏，只要你实现了这个宏。那么我的脚本就支持全自动导入，自动添加，删除。建议在comment部分写上文件名，如果你有了上千个需要翻译的文字，那么文件很大的时候。方便你定位具体的字符。
我的实现原理是借助了：</p>

<pre><code>genstrings -o .m en.lproj
</code></pre>

<p>genstrings 系统自带，可以把一个文件使用了宏的字符，生成对应的文件到 en.lproj 目录中去。</p>

<p>我的脚本已经处理了细节问题，不再需要手动维护。国际化只需要填空就好了。</p>

<h3 id="图片-影视频国际化">图片，影视频国际化<a href="#图片-影视频国际化" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>

<p>这部分国际化很简单:
1. 代码部分
    和在代码的文字部分一样，只要取好key，然后在不同的语言中写好相应的名字就可以。
2. xib和SB部分
    在项目中专门建立一个文件目录放置图片。然后和xib，sb一样。在右侧文件资源监控器中点Localization，然后在项目实际目录中修改就好了。</p>

<p>图片，视频，音频没有区别。</p>

<h3 id="系统权限国际化-infoplist">系统权限国际化&mdash;InfoPlist<a href="#系统权限国际化-infoplist" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>

<p>系统权限部分生成多语言文件部分和其他的没有区别，你只需要在生成的文件中：</p>

<pre><code>NSLocationAlwaysAndWhenInUseUsageDescription = “使用定位的描述”
</code></pre>

<p>查找对应的权限名称，只需要选择showRaw就会出现：
<img src="https://raw.githubusercontent.com/Z-figaro/picBed/master/image/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-04-28%20%E4%B8%8A%E5%8D%883.03.40.png?token=ADLKPSQELAGJBTIJPFRF3V24YST56" alt="" /></p>

<h3 id="系统资源国际化">系统资源国际化<a href="#系统资源国际化" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>

<p>比如进入调取相册页面，通讯录页面,还有复制粘贴的系统提示等，这部分是跟着
CFBundleDevelopmentRegion 这个权限，系统开发语言走的。这个是系统默认语言。当什么都没有的时候，它就会是英文。如果你修改了。系统资源页面会根据你的修改生效。这里很有意思，有两种选择方式：一种是选择国家，一种是选择具体的语言范围。这是两个概念！！如果你要修改默认开发语言，选择国际。如果你要修改系统资源页面，你要选择语言范围。比如：zh_CN</p>

<h3 id="服务器端国际化">服务器端国际化<a href="#服务器端国际化" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>

<p>这部分没有什么特别的好办法，纯粹是两端协商实现。一般就两种：
1.后端完全实现相应的语言提示返回给前端。
2.后端不管语言，返回一套自己规定的提示语言编号集合。前端根据这个编号提示相应的内容。</p>

<h2 id="应用内语言选择">应用内语言选择<a href="#应用内语言选择" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>

<p>其实在iOS中国际化，就是切换不同的语言资源，显示不同的文件信息。然后系统用了一个Localizable的系统宏，来维护key/value的关系。系统中每一种语言对应一种bundle资源文件。当你在切换不同语言的时候，就去找对应的语言包中的资源。所以我们可以利用runtime动态加载不同的bundle来实现语言的切换。在demo中有具体的使用例子。</p>

<p>这个部分一般只有两种实现方式：
1.微信的方式：切换bundle。
2.微博的方式：发送语言切换通知。</p>

<p>这部分讨论的文章已经非常多，并且很成熟了；我就不过多赘述。</p>

<h2 id="疑难问题解决">疑难问题解决<a href="#疑难问题解决" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>

<p>1.阿拉伯地区支持RTL
2.textView系统不支持
3.AttributedString富文本国际化</p>

<p>太晚了，之后慢慢更新。</p>

		</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2019 <a href="https://z-figaro.github.io/">Figaro ZP</a> &#183; <a href="https://creativecommons.org/licenses/by-figaro zp" target="_blank" rel="noopener">CC BY-NC 4.0</a></p>
		<p>
			Made with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> &#183; Theme <a href="https://github.com/Track3/hermit" target="_blank" rel="noopener">Hermit</a> &#183; <a href="https://z-figaro.github.io/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
		</p>
	</footer>


	<script src="https://z-figaro.github.io/js/main.min.784417f5847151f848c339cf0acb13a06cbb648b1483435a28ed4556c4ead69b.js" integrity="sha256-eEQX9YRxUfhIwznPCssToGy7ZIsUg0NaKO1FVsTq1ps="></script>

</body>

</html>
